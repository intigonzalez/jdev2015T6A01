# Media@home web application Docker image## VERSION       1.0# ~~~~ Image base ~~~~FROM ubuntu:trustyMAINTAINER David Bourasseau <dbourasseau@viotech.net># ~~~~ OS Maintenance ~~~~# Keep up-to-date the container OSRUN apt-get update && apt-get upgrade -y# ~~~~  ~~~~#Install Java maven apache mongodb and GitRUN apt-get -y install openjdk-7-jre openjdk-7-jdk apache2 # mongodb-server git maven #create dir /etc/mediahomeRUN mkdir /etc/mediahome # create file box and server configurationRUN touch central.propertiesRUN touch box.propertiesRUN cat > /etc/mediahome/central.properties <<'EOF' \bindIp=0.0.0.0\bindPort=9999\EOF#RUN cat /etc/mediahome/central.propertiesRUN cat > /etc/mediahome/box.properties <<'EOF' \bindIp=0.0.0.0\bindPort=9998\contentPath=/var/www/html\BoxID=BOX_TEST\CentralURL=http://localhost:9999\PublicAddr=http://localhost\EOF# activate module on apacheRUN a2enmod proxy proxy_http headers# activate forward port 80 to 9998RUN touch /etc/apache2/sites-available/mediahome.confRUN echo '<VirtualHost *:80>'> /etc/apache2/sites-available/mediahome.confRUN cat > /etc/apache2/sites-available/mediahome.conf <'EOF' \Header always set Access-Control-Allow-Origin "*"\Header always set Access-Control-Allow-Methods "POST, GET, OPTIONS, DELETE, PUT"\Header always set Access-Control-Max-Age "1000"\Header always set Access-Control-Allow-Headers "x-requested-with, Content-Type, origin, authorization, accept,\ client-security-token, range"\ProxyPass /videos !\ProxyPass / http://localhost:9998/\ProxyPassReverse / http://localhost:9998/\ProxyPreserveHost On\RUN echo '</VirtualHost>' >> /etc/apache2/sites-available/mediahome.confRUN a2dissite 000-default.conf RUN a2ensite mediahome.confRUN service apache2 reloadRUN service apache2 restart# create folder video for put videos inside RUN mkdir /var/www/html/videosRUN chmod 777 /var/www/html/videos